// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Album {
  id          String   @id @default(uuid())
  title       String
  description String?
  artist      Artist   @relation(fields: [artistId], references: [id])
  artistId    String
  label       Label    @relation(fields: [labelId], references: [id])
  labelId     String
  releaseDate DateTime
  releaseState String   // draft, scheduled, published, archived
  price       Float
  currency    String
  genres      String    // Cambiado de String[] a String
  tags        String    // Cambiado de String[] a String
  cover       Image    @relation(fields: [coverId], references: [id])
  coverId     String   @unique  // Relación uno a uno, clave única
  tracks      Track[]
  stats       AlbumStats?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Track {
  id          String   @id @default(uuid())
  title       String
  trackNumber Int
  durationSec Int
  album       Album    @relation(fields: [albumId], references: [id])
  albumId     String
  audio       Audio?
  lyrics      Lyrics?
  stats       TrackStats?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  favorites   Favorite[]  // Relación inversa
}

model Artist {
  id    String  @id @default(uuid())
  name  String
  albums Album[]  // Relación inversa
}

model Label {
  id    String  @id @default(uuid())
  name  String  @unique
  albums Album[]  // Relación inversa
}

model Image {
  id    String @id @default(uuid())
  alt   String?
  width Int
  height Int
  url   String
  album Album? @relation // Relación inversa
}

model Audio {
  id      String @id @default(uuid())
  codec   String
  bitrate Int
  url     String
  track   Track  @relation(fields: [trackId], references: [id])
  trackId String @unique  // Relación uno a uno, clave única
}

model Lyrics {
  id       String @id @default(uuid())
  language String
  text     String
  track    Track  @relation(fields: [trackId], references: [id])
  trackId  String @unique  // Relación uno a uno, clave única
}

model AlbumStats {
  id          String @id @default(uuid())
  playCount   Int
  likeCount   Int
  ratingAvg   Float
  commentCount Int
  album       Album?  @relation(fields: [albumId], references: [id])
  albumId     String? @unique  // Relación uno a uno, clave única
}

model TrackStats {
  id          String @id @default(uuid())
  playCount   Int
  track       Track  @relation(fields: [trackId], references: [id])
  trackId     String @unique  // Relación uno a uno, clave única
}

model Favorite {
  id      String @id @default(uuid())
  track   Track  @relation(fields: [trackId], references: [id])
  trackId String @unique  // Relación uno a uno, clave única
}
